# YouTube Video Metadata, Thumbnail Analysis, and Panel Modeling Pipeline

This repository provides a **full workflow** for collecting YouTube video metadata, analyzing video thumbnails, and performing advanced statistical modeling on the results. The pipeline is designed for research and data analysis projects involving YouTube content, visual analytics, and causal inference.

---

## 1. Python Scripts: Data Collection & Thumbnail Analysis

### 01-Initial-Youtube-Channel-Collection.py

**Purpose:**  
Resolves a list of YouTube channel handles/usernames to channel IDs, collects all related channel URLs and names, and extracts mentioned channels from video descriptions to build a comprehensive channel list.

**Features:**
- **Handle/User Resolution:** Supports both `@handles` and legacy usernames.
- **Channel Metadata:** Collects channel IDs, URLs, and names.
- **Mention Extraction:** Parses video descriptions for `@mentions` and channel links, resolving them to channel IDs and names.
- **Output:** Saves a CSV with all discovered channels for downstream scripts.

**Requirements:**  
- Python 3.x  
- Libraries: `pandas`, `re`, `googleapiclient`

**Usage:**
1. Edit the list of channel handles/usernames in the script.
2. Set your YouTube Data API key.
3. Run the script to generate a `channels_output.csv` file.
[See script][1]

---

### 02-Retrieve-All-Channel-Videos.py

**Purpose:**  
Retrieves metadata for all videos from selected YouTube channels, focusing on medium and long videos published between 2022 and June 2025.

**Features:**
- **Flexible Channel Selection:** Choose channels by row range or index from a CSV.
- **Time Window:** Only fetches videos from 2022–June 2025.
- **Metadata Collection:** Gathers video and channel metadata, including statistics and thumbnails.
- **Thumbnail Download:** Downloads high-quality thumbnails for each video.
- **Output:** Saves metadata and thumbnails in specified directories.

**Requirements:**  
- Python 3.x  
- Libraries: `googleapiclient`, `pandas`, `requests`, `os`, `re`, `time`

**Usage:**
1. Use the CSV generated by the previous script as input.
2. Set the `API_KEY`, `CSV_PATH`, `OUTPUT_DIR`, and `THUMBNAIL_DIR` in the script.
3. Run the script, select channels interactively, and collect metadata.
[See script][2]

---

### 03-Thumbnail-Analysis.py

**Purpose:**  
Performs detailed visual and textual analysis on video thumbnails, extracting features for modeling.

**Features:**
- **Color & Brightness:** Extracts dominant colors, palettes, and brightness metrics.
- **Visual Complexity:** Computes edge counts and entropy.
- **Object Detection:** Uses YOLOv8 for object detection and counting.
- **Face & Emotion Analysis:** Uses DeepFace for face, age, gender, and emotion detection.
- **Text Analysis:** Extracts text using EasyOCR.
- **Element Complexity:** Combines object and text counts.
- **Parallel Processing & Logging:** Efficient and robust for large datasets.
- **Output:** Saves separate CSVs for each feature set.

**Requirements:**  
- Python 3.x  
- Libraries: `pandas`, `numpy`, `cv2`, `PIL`, `deepface`, `colorthief`, `ultralytics`, `easyocr`, `skimage`, `extcolors`, `Pylette`, `concurrent.futures`, `tqdm`, `logging`

**Usage:**
1. Place thumbnails in `THUMBNAILS_DIR`.
2. Set `THUMBNAILS_DIR` and `OUTPUT_DIR`.
3. Run the script; outputs are saved as CSVs.
[See script][3]

---

### 04-Preprocessing-Feature-Engineering.py

**Purpose:**  
Merges and engineers features from all previous outputs, preparing a modeling-ready dataset.

**Features:**
- **Metadata Concatenation:** Merges all video metadata CSVs into a single file.
- **Feature Engineering:** Calculates sentiment scores, text presence, title length, tag statistics, and more.
- **Data Merging:** Combines all feature CSVs (visual, object, face, color, text) with video metadata.
- **Column Filtering:** Retains only relevant columns for modeling.
- **Output:** Final merged CSV for statistical analysis.

**Requirements:**  
- Python 3.x  
- Libraries: `pandas`, `numpy`, `ast`, `re`, `vaderSentiment`

**Usage:**
1. Set `BASE_PATH` and input/output folders.
2. Ensure all feature CSVs and metadata are in place.
3. Run the script to generate a modeling-ready CSV.
[See script][4]

---

### (Optional) Thumbnail-Analysis-Overlays.ipynb

**Purpose:**  
Visualizes the results of thumbnail analysis by overlaying detected objects, faces, and text on thumbnail images.

**Features:**
- **Overlay Visualizations:** Draws bounding boxes and labels for objects, faces, and detected text.
- **Sampled Output:** Processes and saves overlays for a random sample of thumbnails.
- **Output:** Saves images with overlays and a CSV with analysis results.

**Requirements:**  
- Python 3.x  
- Libraries: as above, plus `matplotlib`

**Usage:**
1. Set `THUMBNAILS_DIR` and `OUTPUT_DIR`.
2. Run the notebook to generate and view overlays.
[See notebook][6]

---

## 2. R Scripts: Panel Analysis of Thumbnail Features

*See original README for details on R scripts and statistical modeling workflow.*

---

## 3. Data Exploration & Plotting

**Data-Exploration-Plotting.ipynb:**  
Explore, summarize, and visualize the merged dataset. Provides summary statistics and sample visualizations for all engineered features.
[See notebook][5]

---

## Notes

- All scripts are modular and can be run independently.
- The workflow is now fully reproducible from initial channel collection to modeling-ready data.
- For best results, run scripts in order: **01 → 02 → 03 → 04**.

**Changelog:**  
- Added: `01-Initial-Youtube-Channel-Collection.py` (channel discovery & mentions)
- Added: `02-Retrieve-All-Channel-Videos.py` (full video metadata for 2022–2025)
- Added: `03-Thumbnail-Analysis.py` (feature extraction from thumbnails)
- Added: `04-Preprocessing-Feature-Engineering.py` (feature engineering & merging)
- Added: `Thumbnail-Analysis-Overlays.ipynb` (visual overlays, optional)
- Added: `Data-Exploration-Plotting.ipynb` (exploratory analysis, optional)

*Replace all placeholder paths and API keys in scripts before running.*

---

**Script Order:**

1. `01-Initial-Youtube-Channel-Collection.py`
2. `02-Retrieve-All-Channel-Videos.py`
3. `03-Thumbnail-Analysis.py`
4. `04-Preprocessing-Feature-Engineering.py`
5. *(Optional)* `Thumbnail-Analysis-Overlays.ipynb`
6. *(Optional)* `Data-Exploration-Plotting.ipynb`

---

**Tip:**  
All outputs are saved as CSVs and images in the specified output folders for easy integration with R scripts and further analysis.

---

[1]: # (01-Initial-Youtube-Channel-Collection.py)
[2]: # (02-Retrieve-All-Channel-Videos.py)
[3]: # (03-Thumbnail-Analysis.py)
[4]: # (04-Preprocessing-Feature-Engineering.py)
[5]: # (Data-Exploration-Plotting.ipynb)
[6]: # (Thumbnail-Analysis-Overlays.ipynb)

---

## 2. R Scripts: Panel Analysis of Thumbnail Features

These R scripts analyze the effects of thumbnail features (face and text presence) on video performance (views, likes) using advanced count data models. The workflow includes propensity score matching, Poisson Pseudo-Maximum Likelihood (PPML), and Negative Binomial Regression (NBR), with and without channel and month fixed effects.

### File Overview

| Script Name                                    | Model(s)    | Fixed Effects        | Description                                       |
|------------------------------------------------|-------------|----------------------|---------------------------------------------------|
| Thesis-Overdispersion-PPML-NBR-Fixed-Effects.R | PPML, NBR   | Channel, Month       | Full workflow: matching, modeling, visualization  |
| Thesis-Overdispersion-NBR-Fixed-Effects.R      | NBR         | Channel, Month       | NBR with/without panel regression, time trends    |
| Thesis-Overdispersion-PPML-Fixed-Effects.R     | PPML        | Channel, Month       | PPML with matching, fixed effects, time trends    |
| Thesis-Overdispersion-NBR-No-Fixed-Effects.R   | NBR         | None                 | NBR without fixed effects, matching, visualization|
| Thesis-Overdispersion-PPML-No-Fixed-Effects.R  | PPML        | None                 | PPML without fixed effects, matching, visualization|

---

### Data Requirements

All scripts expect a CSV file with columns such as:
- `face_present`, `text_presence`, `channel_name`, `published_at`
- `view_count`, `like_count`, `title_sentiment_score`, `text_sentiment_score`
- `duration`, `title_len`, `tags_presence`, `colorfulness_pylette`, `brightness_pil`, `edge_count`, `entropy_mean`, `object_count_yolo`, `channel_subscribers`

**Update the `file_path` variable in each script to match your data location.**

---

### Workflow Summary

**1. Load Required Libraries**
- `tidyverse`, `MatchIt`, `fixest`, `cobalt`, `nnet`, `broom`, `ggeffects`, `ggplot2`, `patchwork` (for some scripts)

**2. Data Preparation**
- Read CSV, convert types, create `face_text_combo` (neither, face_only, text_only, both)

**3. Overdispersion Diagnostics**
- Print mean, variance, and variance-to-mean ratio for count outcomes

**4. Propensity Score Matching**
- Matching for `face_presence`, `text_presence`, and `face_text_combo` using covariates

**5. Model Estimation**
- PPML and NBR models, with and without fixed effects for channel and month

**6. Output and Visualization**
- Coefficient tables (CSV), forest plots, predicted value plots, residuals, temporal trends, fixed effects plots

---

### Script Selection Guide

| Analysis Goal                                  | Use Script(s)                                     |
|------------------------------------------------|---------------------------------------------------|
| Full workflow (matching, PPML & NBR, FE, plots)| Thesis-Overdispersion-PPML-NBR-Fixed-Effects.R    |
| Only Negative Binomial, with FE                | Thesis-Overdispersion-NBR-Fixed-Effects.R         |
| Only PPML, with FE                             | Thesis-Overdispersion-PPML-Fixed-Effects.R        |
| Only Negative Binomial, no FE                  | Thesis-Overdispersion-NBR-No-Fixed-Effects.R      |
| Only PPML, no FE                               | Thesis-Overdispersion-PPML-No-Fixed-Effects.R     |

---

### How to Run

1. **Edit the data path** in each script to point to your CSV file.
2. **Open the script in RStudio** or another R environment.
3. **Run the script** section by section, or source the entire script.
4. **Check output files** (plots, CSVs) in your working directory.

---

### Key Functions and Outputs

- `check_overdisp()`: Prints mean/variance diagnostics
- `matchit()`: Propensity score matching
- `fepois()` / `fenegbin()`: PPML/NBR models (with/without fixed effects)
- `ggpredict()`: Marginal predictions for plotting
- `ggplot2`: Visualizations

---

## Notes

- All scripts assume the presence of the same covariates and outcome variables.
- Fixed effects models are recommended for causal inference when unobserved heterogeneity is suspected.
- Scripts are modular and can be adapted for additional treatments or outcomes.
